<!DOCTYPE html>




<html lang="en">
  <head>
    <meta charset="utf-8" />
    
    <title>csdmpy.csdm &mdash; csdmpy 0.2 documentation</title>
    <meta name="description" content="">
    <meta name="author" content="">

    

<link rel="stylesheet" href="../../_static/css/basicstrap-base.css" type="text/css" />
<link rel="stylesheet" id="current-theme" href="../../_static/css/bootstrap3/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" id="current-adjust-theme" type="text/css" />

<link rel="stylesheet" href="../../_static/css/font-awesome.min.css">

<style type="text/css">
  body {
    padding-top: 60px;
    padding-bottom: 40px;
  }
</style>

<link rel="stylesheet" href="../../_static/css/basicstrap.css" type="text/css" />
<link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
<link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />
    
<script type="text/javascript">
  var DOCUMENTATION_OPTIONS = {
            URL_ROOT:    '../../',
            VERSION:     '0.2',
            COLLAPSE_INDEX: false,
            FILE_SUFFIX: '.html',
            HAS_SOURCE:  true
  };
</script>
    <script type="text/javascript" src="../../_static/js/jquery.min.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../_static/js/bootstrap3.min.js"></script>
<script type="text/javascript" src="../../_static/js/jquery.cookie.min.js"></script>
<script type="text/javascript" src="../../_static/js/basicstrap.js"></script>
<script type="text/javascript">
</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="top" title="csdmpy 0.2 documentation" href="../../index.html" />
    <link rel="up" title="csdmpy" href="../csdmpy.html" /> 
  </head>
  <body role="document">
    <div id="navbar-top" class="navbar navbar-fixed-top navbar-inverse" role="navigation" aria-label="top navigation">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../../index.html">csdmpy 0.2 documentation</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">

            
              <li><a href="../../genindex.html" title="General Index" accesskey="I">index </a></li>
              <li><a href="../index.html" >Module code</a></li>
              <li><a href="../csdmpy.html" accesskey="U">csdmpy</a></li>
            

            <li class="visible-xs">
                <form class="search form-search form-inline navbar-form navbar-right sp-searchbox" action="../../search.html" method="get">
                  <div class="input-append input-group">
                    <input type="text" class="search-query form-control" name="q" placeholder="Search...">
                    <span class="input-group-btn">
                    <input type="submit" class="btn" value="Go" />
                    </span>
                  </div>
                  <input type="hidden" name="check_keywords" value="yes" />
                  <input type="hidden" name="area" value="default" />
                </form>
            </li>

            

          </ul>

        </div>
      </div>
    </div>
    

    <!-- container -->
    <div class="container-fluid">

      <!-- row -->
      <div class="row">
         
<div class="col-md-3 hidden-xs" id="sidebar-wrapper">
  <div class="sidebar hidden-xs" role="navigation" aria-label="main navigation">
    <p class="logo"><a href="../../index.html">
      <img class="logo" src="../../_static/csdmpy.png" alt="Logo"/>
    </a></p>
<div id="searchbox" role="search">
  <h3>Quick search</h3>
  <form class="search form-inline" action="../../search.html" method="get">
      <div class="input-append input-group">
        <input type="text" class="search-query form-control" name="q" placeholder="Search...">
        <span class="input-group-btn">
        <input type="submit" class="btn" value="Go" />
        </span>
      </div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
  </div>
</div> 
        

        <div class="col-md-9" id="content-wrapper">
          <div class="document" role="main">
            <div class="documentwrapper">
              <div class="bodywrapper">
                <div class="body">
                  
  <h1>Source code for csdmpy.csdm</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;THE CSDM object&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">deepcopy</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">astropy.units.quantity</span> <span class="k">import</span> <span class="n">Quantity</span>

<span class="kn">from</span> <span class="nn">csdmpy.abstract_list</span> <span class="k">import</span> <span class="n">__dimensions_list__</span>  <span class="c1"># lgtm [py/import-own-module]</span>
<span class="kn">from</span> <span class="nn">csdmpy.abstract_list</span> <span class="k">import</span> <span class="n">DependentVariableList</span>  <span class="c1"># lgtm [py/import-own-module]</span>
<span class="kn">from</span> <span class="nn">csdmpy.abstract_list</span> <span class="k">import</span> <span class="n">DimensionList</span>  <span class="c1"># lgtm [py/import-own-module]</span>
<span class="kn">from</span> <span class="nn">csdmpy.dependent_variables</span> <span class="k">import</span> <span class="p">(</span>  <span class="c1"># lgtm [py/import-own-module] # noqa: F401</span>
    <span class="n">as_dependent_variable</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># lgtm [py/unused-import]</span>
<span class="kn">from</span> <span class="nn">csdmpy.dependent_variables</span> <span class="k">import</span> <span class="n">DependentVariable</span>  <span class="c1"># lgtm [py/import-own-module]</span>
<span class="kn">from</span> <span class="nn">csdmpy.dimensions</span> <span class="k">import</span> <span class="n">as_dimension</span>  <span class="c1"># lgtm [py/import-own-module]</span>
<span class="kn">from</span> <span class="nn">csdmpy.dimensions</span> <span class="k">import</span> <span class="n">Dimension</span>  <span class="c1"># lgtm [py/import-own-module] # noqa: F401</span>
<span class="kn">from</span> <span class="nn">csdmpy.dimensions</span> <span class="k">import</span> <span class="p">(</span>  <span class="c1"># lgtm [py/import-own-module] # noqa: F401</span>
    <span class="n">LabeledDimension</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># lgtm [py/unused-import]</span>
<span class="kn">from</span> <span class="nn">csdmpy.dimensions</span> <span class="k">import</span> <span class="p">(</span>  <span class="c1"># lgtm [py/import-own-module] # noqa: F401</span>
    <span class="n">LinearDimension</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">csdmpy.dimensions</span> <span class="k">import</span> <span class="p">(</span>  <span class="c1"># lgtm [py/import-own-module] # noqa: F401</span>
    <span class="n">MonotonicDimension</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># lgtm [py/unused-import]</span>
<span class="kn">from</span> <span class="nn">csdmpy.units</span> <span class="k">import</span> <span class="n">string_to_quantity</span>  <span class="c1"># lgtm [py/import-own-module]</span>
<span class="kn">from</span> <span class="nn">csdmpy.utils</span> <span class="k">import</span> <span class="n">_get_broadcast_shape</span>  <span class="c1"># lgtm [py/import-own-module]</span>
<span class="kn">from</span> <span class="nn">csdmpy.utils</span> <span class="k">import</span> <span class="n">check_scalar_object</span>  <span class="c1"># lgtm [py/import-own-module]</span>
<span class="kn">from</span> <span class="nn">csdmpy.utils</span> <span class="k">import</span> <span class="n">validate</span>  <span class="c1"># lgtm [py/import-own-module]</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;CSDM&quot;</span><span class="p">]</span>
<span class="n">__ufunc_list_dimensionless_unit__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">cosh</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">arcsinh</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">arccosh</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">arctanh</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">exp2</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">expm1</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">__ufunc_list_unit_independent__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">np</span><span class="o">.</span><span class="n">negative</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">positive</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">fabs</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">rint</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">__ufunc_list_applies_to_unit__</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cbrt</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">reciprocal</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">]</span>

<span class="n">__function_reduction_list__</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">]</span>

<span class="n">__other_functions__</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">]</span>

<span class="n">__shape_manipulation_functions__</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">]</span>


<div class="viewcode-block" id="CSDM"><a class="viewcode-back" href="../../api/CSDM.html#csdmpy.CSDM">[docs]</a><span class="k">class</span> <span class="nc">CSDM</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create an instance of a CSDM class.</span>

<span class="sd">    This class is based on the root CSDM object of the core scientific dataset</span>
<span class="sd">    (CSD) model. The class is a composition of the :ref:`dv_api` and</span>
<span class="sd">    :ref:`dim_api` instances, where an instance of the :ref:`dv_api` class</span>
<span class="sd">    describes a :math:`p`-component dependent variable, and an instance of the</span>
<span class="sd">    :ref:`dim_api` class describes a dimension of a :math:`d`-dimensional</span>
<span class="sd">    space. Additional attributes of this class are listed below.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">__latest_CSDM_version__</span> <span class="o">=</span> <span class="s2">&quot;1.0&quot;</span>  <span class="c1"># __version__</span>
    <span class="n">_old_compatible_versions</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">_old_incompatible_versions</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;0.0.9&quot;</span><span class="p">,</span> <span class="s2">&quot;0.0.10&quot;</span><span class="p">,</span> <span class="s2">&quot;0.0.11&quot;</span><span class="p">)</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;_dimensions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_dependent_variables&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_tags&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_read_only&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_version&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_timestamp&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_geographic_coordinate&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_description&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_application&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_filename&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Python module from reading and writing csdm files.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">version</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__latest_CSDM_version__</span>
        <span class="k">elif</span> <span class="n">version</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_old_incompatible_versions</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="n">f</span><span class="s2">&quot;Files created with the version </span><span class="si">{version}</span><span class="s2"> of the CSD Model &quot;</span>
                <span class="s2">&quot;are no longer supported.&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_read_only</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_version</span> <span class="o">=</span> <span class="n">version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timestamp</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_geographic_coordinate</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_description</span> <span class="o">=</span> <span class="n">description</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_application</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">filename</span>

        <span class="n">kwargs_keys</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span> <span class="o">=</span> <span class="n">DimensionList</span><span class="p">([])</span>
        <span class="k">if</span> <span class="s2">&quot;dimensions&quot;</span> <span class="ow">in</span> <span class="n">kwargs_keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;dimensions&quot;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">t_</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;dimensions&quot;</span><span class="p">])</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="n">f</span><span class="s2">&quot;A list of valid Dimension objects or equivalent dictionary &quot;</span>
                    <span class="n">f</span><span class="s2">&quot;objects is required, found </span><span class="si">{t_}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;dimensions&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_dimension</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dependent_variables</span> <span class="o">=</span> <span class="n">DependentVariableList</span><span class="p">([])</span>
        <span class="k">if</span> <span class="s2">&quot;dependent_variables&quot;</span> <span class="ow">in</span> <span class="n">kwargs_keys</span><span class="p">:</span>
            <span class="n">t_</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;dependent_variables&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;dependent_variables&quot;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="n">f</span><span class="s2">&quot;A list of valid DependentVariable objects or equivalent &quot;</span>
                    <span class="n">f</span><span class="s2">&quot;dictionary objects is required, found </span><span class="si">{t_}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;dependent_variables&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_dependent_variable</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;dimensions&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dependent_variables&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tags&quot;</span><span class="p">,</span>
            <span class="s2">&quot;read_only&quot;</span><span class="p">,</span>
            <span class="s2">&quot;version&quot;</span><span class="p">,</span>
            <span class="s2">&quot;timestamp&quot;</span><span class="p">,</span>
            <span class="s2">&quot;geographic_coordinate&quot;</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">,</span>
            <span class="s2">&quot;application&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{k}</span><span class="s2">={getattr(self, k).__repr__()}&quot;</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">f</span><span class="s2">&quot;CSDM(</span><span class="si">{prop}</span><span class="s2">)&quot;</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">prop_dv</span> <span class="o">=</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">item</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">])</span>
        <span class="n">prop_dim</span> <span class="o">=</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">item</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">prop_dv</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span><span class="s2">&quot;CSDM(</span><span class="se">\n</span><span class="si">{prop_dim}</span><span class="se">\n</span><span class="s2">)&quot;</span>
        <span class="k">if</span> <span class="n">prop_dim</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span><span class="s2">&quot;CSDM(</span><span class="se">\n</span><span class="si">{prop_dv}</span><span class="se">\n</span><span class="s2">)&quot;</span>
        <span class="k">return</span> <span class="n">f</span><span class="s2">&quot;CSDM(</span><span class="se">\n</span><span class="si">{prop_dv}</span><span class="s2">,</span><span class="se">\n</span><span class="si">{prop_dim}</span><span class="se">\n</span><span class="s2">)&quot;</span>

    <span class="k">def</span> <span class="nf">__check_csdm_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if the two objects are csdm objects&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">CSDM</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="n">f</span><span class="s2">&quot;unsupported operand type(s) </span><span class="si">{operator}</span><span class="s2">: &#39;CSDM&#39; and &quot;</span>
                <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{other.__class__.__name__}</span><span class="s2">&#39;.&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__check_dimension_equality</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if the dimensions of the two csdm objects are identical.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">dimensions</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="n">f</span><span class="s2">&quot;Cannot operate on CSDM objects with different dimensions.&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__check_dependent_variable_len_equality</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if the length of dependent variables from the two csdm objects is equal.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Cannot operate on CSDM objects with differnet lengths of &quot;</span>
                <span class="s2">&quot;dependent variables.&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__check_dependent_variable_dimensionality</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if the dependent variables from the two csdm objects have the same</span>
<span class="sd">        dimensionality.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">v1</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">physical_type</span> <span class="o">!=</span> <span class="n">v2</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">physical_type</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;Cannot operate on dependent variables with physical types: &quot;</span>
                    <span class="n">f</span><span class="s2">&quot;</span><span class="si">{v1.unit.physical_type}</span><span class="s2"> and </span><span class="si">{v2.unit.physical_type}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__check_csdm_object_additive_compatibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Check if the two objects are compatible for additive operations</span>
<span class="sd">                1) csdm objects,</span>
<span class="sd">                2) with identical dimension objects,</span>
<span class="sd">                3) same number of dependent-variables, and</span>
<span class="sd">                4) each dependent variables with identical dimensionality.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># self.__check_csdm_object(other)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_dimension_equality</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_dependent_variable_len_equality</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_dependent_variable_dimensionality</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check the other object is a CSDM object with identical attribute values.</span>
<span class="sd">        This does not check for the timestamp attribute.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">CSDM</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">check</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">dimensions</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dependent_variables</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tags</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">tags</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_only</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">read_only</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
            <span class="c1"># self.timestamp == other.timestamp,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">geographic_coordinate</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">geographic_coordinate</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">application</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">application</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">check</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return negative of self.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">negative</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return positive of self.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return absolute of self.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="c1"># def __complex__(self):</span>
    <span class="c1">#     &quot;&quot;&quot;Return self as complex.&quot;&quot;&quot;</span>
    <span class="c1">#     return self.astype(complex)</span>

    <span class="c1"># def __int__(self):</span>
    <span class="c1">#     &quot;&quot;&quot;Return self as int.&quot;&quot;&quot;</span>
    <span class="c1">#     return self.astype(int)</span>

    <span class="c1"># def __float__(self):</span>
    <span class="c1">#     &quot;&quot;&quot;Return self as float.&quot;&quot;&quot;</span>
    <span class="c1">#     return self.astype(float)</span>

    <span class="c1"># def __invert__(self):</span>
    <span class="c1">#     raise NotImplementedError(&quot;&quot;)</span>

    <span class="c1"># def __lshift__(self, other):</span>
    <span class="c1">#     raise NotImplementedError()</span>

    <span class="c1"># def __ilshift__(self, other):</span>
    <span class="c1">#     raise NotImplementedError()</span>

    <span class="c1"># def __rshift__(self, other):</span>
    <span class="c1">#     raise NotImplementedError()</span>

    <span class="c1"># def __irshift__(self, other):</span>
    <span class="c1">#     raise NotImplementedError()</span>

    <span class="k">def</span> <span class="nf">__ifunction__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">CSDM</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__check_csdm_object_additive_compatibility</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">):</span>
                <span class="n">factor</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                <span class="n">fn</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">components</span><span class="p">,</span> <span class="n">function</span><span class="p">)</span>
                <span class="n">fn</span><span class="p">(</span><span class="n">factor</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">components</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="n">other</span> <span class="o">=</span> <span class="n">check_scalar_object</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">symbol</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">):</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">components</span><span class="p">,</span> <span class="n">function</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">):</span>
                <span class="n">fn</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">factor</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                <span class="n">fn</span><span class="p">(</span><span class="n">factor</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add two objects (z=x+y), if the other object is a</span>
<span class="sd">            1) csdm or scalar object,</span>
<span class="sd">            2) with identical dimension objects,</span>
<span class="sd">            3) same number of dependent-variables, and</span>
<span class="sd">            4) each dependent variables with identical dimensionality.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">CSDM</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__check_csdm_object_additive_compatibility</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

            <span class="n">d1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">d1</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">):</span>
                <span class="n">factor</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                <span class="n">item</span><span class="o">.</span><span class="n">components</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">item</span><span class="o">.</span><span class="n">components</span> <span class="o">+</span> <span class="n">factor</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">components</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="n">d1</span>

        <span class="n">other</span> <span class="o">=</span> <span class="n">check_scalar_object</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">)</span>
        <span class="n">d1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">d1</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">):</span>
                <span class="n">item</span><span class="o">.</span><span class="n">components</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">components</span> <span class="o">+</span> <span class="n">other</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">factor</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                <span class="n">item</span><span class="o">.</span><span class="n">components</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">components</span> <span class="o">+</span> <span class="n">factor</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span>
        <span class="k">return</span> <span class="n">d1</span>

    <span class="k">def</span> <span class="nf">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Right add two objects. See __add__ for details.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__add__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add two objects in-place (y+=x).  See __add__ for details.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ifunction__</span><span class="p">(</span><span class="s2">&quot;__iadd__&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Subtract two objects (z=x-y), if the other is</span>
<span class="sd">            1) csdm or scalar object,</span>
<span class="sd">            2) with identical dimension objects,</span>
<span class="sd">            3) same number of dependent-variables, and</span>
<span class="sd">            4) each dependent variables with identical dimensionality.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">CSDM</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__check_csdm_object_additive_compatibility</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

            <span class="n">d1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">d1</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">):</span>
                <span class="n">factor</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                <span class="n">item</span><span class="o">.</span><span class="n">components</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">item</span><span class="o">.</span><span class="n">components</span> <span class="o">-</span> <span class="n">factor</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">components</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="n">d1</span>

        <span class="n">other</span> <span class="o">=</span> <span class="n">check_scalar_object</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span>
        <span class="n">d1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">d1</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">):</span>
                <span class="n">item</span><span class="o">.</span><span class="n">components</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">components</span> <span class="o">-</span> <span class="n">other</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">factor</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                <span class="n">item</span><span class="o">.</span><span class="n">components</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">components</span> <span class="o">-</span> <span class="n">factor</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span>
        <span class="k">return</span> <span class="n">d1</span>

    <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Right subtract two objects. See __sub__ for details.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="fm">__sub__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__isub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Subtract two objects in-lace (y-=x). See __sub__ for details. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ifunction__</span><span class="p">(</span><span class="s2">&quot;__isub__&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Multiply the components of the CSDM object by a scalar.&quot;&quot;&quot;</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">check_scalar_object</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">)</span>

        <span class="n">d1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">d1</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">):</span>
                <span class="n">item</span><span class="o">.</span><span class="n">components</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">components</span> <span class="o">*</span> <span class="n">other</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">item</span><span class="o">.</span><span class="n">subtype</span><span class="o">.</span><span class="n">_unit</span> <span class="o">*</span> <span class="n">other</span>
                <span class="n">item</span><span class="o">.</span><span class="n">subtype</span><span class="o">.</span><span class="n">_unit</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">unit</span>
                <span class="n">item</span><span class="o">.</span><span class="n">components</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">components</span> <span class="o">*</span> <span class="n">value</span><span class="o">.</span><span class="n">value</span>
        <span class="k">return</span> <span class="n">d1</span>

    <span class="k">def</span> <span class="nf">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Right multiply the components of the CSDM object by a scalar.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__mul__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;In place multiplication of the components of the CSDM object by a scalar.&quot;&quot;&quot;</span>

        <span class="n">other</span> <span class="o">=</span> <span class="n">check_scalar_object</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">):</span>
                <span class="n">item</span><span class="o">.</span><span class="n">components</span> <span class="o">*=</span> <span class="n">other</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">item</span><span class="o">.</span><span class="n">subtype</span><span class="o">.</span><span class="n">_unit</span> <span class="o">*</span> <span class="n">other</span>
                <span class="n">item</span><span class="o">.</span><span class="n">subtype</span><span class="o">.</span><span class="n">_unit</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">unit</span>
                <span class="n">item</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="fm">__imul__</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Divide the components of the CSDM object by a scalar.&quot;&quot;&quot;</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">check_scalar_object</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>

        <span class="n">d1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">d1</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">):</span>
                <span class="n">item</span><span class="o">.</span><span class="n">components</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">components</span> <span class="o">/</span> <span class="n">other</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="n">item</span><span class="o">.</span><span class="n">subtype</span><span class="o">.</span><span class="n">_unit</span><span class="p">)</span> <span class="o">/</span> <span class="n">other</span>
                <span class="n">item</span><span class="o">.</span><span class="n">subtype</span><span class="o">.</span><span class="n">_unit</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">unit</span>
                <span class="n">item</span><span class="o">.</span><span class="n">components</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">components</span> <span class="o">*</span> <span class="n">value</span><span class="o">.</span><span class="n">value</span>
        <span class="k">return</span> <span class="n">d1</span>

    <span class="k">def</span> <span class="nf">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Right divide the components of the CSDM object by a scalar.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">reciprocal</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">*</span> <span class="n">other</span>

    <span class="k">def</span> <span class="nf">__itruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;In place division of the components of the CSDM object by a scalar.&quot;&quot;&quot;</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">check_scalar_object</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">):</span>
                <span class="n">item</span><span class="o">.</span><span class="n">components</span> <span class="o">*=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">other</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="n">item</span><span class="o">.</span><span class="n">subtype</span><span class="o">.</span><span class="n">_unit</span><span class="p">)</span> <span class="o">/</span> <span class="n">other</span>
                <span class="n">item</span><span class="o">.</span><span class="n">subtype</span><span class="o">.</span><span class="n">_unit</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">unit</span>
                <span class="n">item</span><span class="o">.</span><span class="n">components</span> <span class="o">*=</span> <span class="n">value</span><span class="o">.</span><span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Raise the components of the CSDM object to a scalar value.&quot;&quot;&quot;</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">check_scalar_object</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s2">&quot;**&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__ipow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Raise the components of the CSDM object to a scalar value.&quot;&quot;&quot;</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">check_scalar_object</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s2">&quot;**&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">:</span>
            <span class="n">item</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="fm">__ipow__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="n">item</span><span class="o">.</span><span class="n">subtype</span><span class="o">.</span><span class="n">_unit</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">subtype</span><span class="o">.</span><span class="n">_unit</span> <span class="o">**</span> <span class="n">other</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_get_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">l_</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">indices</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span>
                <span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">_</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="n">l_</span><span class="p">:]]</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">slice</span><span class="p">)):</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="p">(</span><span class="n">indices</span><span class="p">,)</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span>
                <span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">_</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                    <span class="s2">&quot;CSDMpy supports the grid base scientific dataset described in the&quot;</span>
                    <span class="s2">&quot; Core Scientific dataset model. Fancy indexing using tuples or &quot;</span>
                    <span class="s2">&quot;lists may result in a scatter dataset, and is not implemented in &quot;</span>
                    <span class="s2">&quot;the current version.&quot;</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">indices</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_indices</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">:</span>
            <span class="n">section</span> <span class="o">=</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">components</span><span class="p">),</span> <span class="mi">1</span><span class="p">),)</span> <span class="o">+</span> <span class="n">indices</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">variable</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">section</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a csdm object corresponding to given indices.&quot;&quot;&quot;</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_indices</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
        <span class="n">csdm</span> <span class="o">=</span> <span class="n">CSDM</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">):</span>
            <span class="n">s_</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="n">dim_</span> <span class="o">=</span> <span class="n">dim</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="s2">&quot;subtype&quot;</span><span class="p">):</span>
                <span class="n">dim_</span> <span class="o">=</span> <span class="n">dim</span><span class="o">.</span><span class="n">subtype</span>

            <span class="n">length_</span> <span class="o">=</span> <span class="n">dim</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">s_</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
            <span class="k">if</span> <span class="n">length_</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dim_</span><span class="p">,</span> <span class="s2">&quot;_equivalencies&quot;</span><span class="p">):</span>
                    <span class="n">equivalencies_</span> <span class="o">=</span> <span class="n">dim_</span><span class="o">.</span><span class="n">_equivalencies</span>
                    <span class="n">dim_</span><span class="o">.</span><span class="n">_equivalencies</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">dim</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">s_</span><span class="p">]</span>
                    <span class="n">new_dim</span> <span class="o">=</span> <span class="n">as_dimension</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
                    <span class="n">dim_</span><span class="o">.</span><span class="n">_equivalencies</span> <span class="o">=</span> <span class="n">equivalencies_</span>
                    <span class="n">new_dim</span><span class="o">.</span><span class="n">_equivalencies</span> <span class="o">=</span> <span class="n">equivalencies_</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">dim</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">s_</span><span class="p">]</span>
                    <span class="n">new_dim</span> <span class="o">=</span> <span class="n">as_dimension</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

                <span class="n">new_dim</span><span class="o">.</span><span class="n">_copy_metadata</span><span class="p">(</span><span class="n">dim_</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">new_dim</span><span class="p">,</span> <span class="s2">&quot;complex_fft&quot;</span><span class="p">):</span>
                    <span class="n">new_dim</span><span class="o">.</span><span class="n">complex_fft</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dim_</span><span class="p">,</span> <span class="s2">&quot;_equivalencies&quot;</span><span class="p">):</span>
                    <span class="n">dim_</span><span class="o">.</span><span class="n">_equivalencies</span> <span class="o">=</span> <span class="n">equivalencies_</span>
                    <span class="n">new_dim</span><span class="o">.</span><span class="n">_equivalencies</span> <span class="o">=</span> <span class="n">equivalencies_</span>

                <span class="n">csdm</span><span class="o">.</span><span class="n">_dimensions</span> <span class="o">+=</span> <span class="p">[</span><span class="n">new_dim</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">:</span>
            <span class="n">section</span> <span class="o">=</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">components</span><span class="p">),</span> <span class="mi">1</span><span class="p">),)</span> <span class="o">+</span> <span class="n">indices</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">section</span><span class="p">]</span>
            <span class="n">dv</span> <span class="o">=</span> <span class="n">empty_dependent_variable</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">numeric_type</span><span class="p">)</span>
            <span class="n">dv</span><span class="o">.</span><span class="n">subtype</span><span class="o">.</span><span class="n">_components</span> <span class="o">=</span> <span class="n">y</span>
            <span class="n">dv</span><span class="o">.</span><span class="n">_copy_metadata</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>
            <span class="n">csdm</span><span class="o">.</span><span class="n">_dependent_variables</span> <span class="o">+=</span> <span class="p">[</span><span class="n">dv</span><span class="p">]</span>

        <span class="n">csdm</span><span class="o">.</span><span class="n">_copy_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">csdm</span>

    <span class="k">def</span> <span class="nf">_copy_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_version</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">_version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_description</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">_description</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_read_only</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">_read_only</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">_tags</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timestamp</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">_timestamp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_geographic_coordinate</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">_geographic_coordinate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_application</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">_application</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">_filename</span>

    <span class="c1"># ----------------------------------------------------------------------- #</span>
    <span class="c1">#                                Attributes                               #</span>
    <span class="c1"># ----------------------------------------------------------------------- #</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Version number of the CSD model on file.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Description of the dataset. The default value is an empty string.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; print(data.description)</span>
<span class="sd">            A simulated sine curve.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A string of UTF-8 allows characters describing the dataset.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: When the assigned value is not a string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_description</span>

    <span class="nd">@description</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_description</span> <span class="o">=</span> <span class="n">validate</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">read_only</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If True, the data-file is serialized as read only, otherwise, False.</span>

<span class="sd">        By default, the :ref:`csdm_api` object loads a copy of the .csdf(e) file,</span>
<span class="sd">        irrespective of the value of the `read_only` attribute. The value of this</span>
<span class="sd">        attribute may be toggled at any time after the file import.</span>
<span class="sd">        When serializing the `.csdf(e)` file, if the value of the `read_only`</span>
<span class="sd">        attribute is found True, the file will be serialized as read only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_only</span>

    <span class="nd">@read_only</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">read_only</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_read_only</span> <span class="o">=</span> <span class="n">validate</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;read_only&quot;</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;List of tags attached to the dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span>

    <span class="nd">@tags</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">tags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span> <span class="o">=</span> <span class="n">validate</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">timestamp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Timestamp from when the file was last serialized. This attribute is real only.</span>

<span class="sd">        The timestamp stamp is a string representation of the Coordinated Universal</span>
<span class="sd">        Time (UTC) formatted according to the iso-8601 standard.</span>

<span class="sd">        Raises:</span>
<span class="sd">            AttributeError: When the attribute is modified.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timestamp</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">geographic_coordinate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Geographic coordinate, if present, from where the file was last serialized.</span>
<span class="sd">        This attribute is read-only.</span>

<span class="sd">        The geographic coordinates correspond to the location where the file was last</span>
<span class="sd">        serialized. If present, the geographic coordinates are described with three</span>
<span class="sd">        attributes, the required latitude and longitude, and an optional altitude.</span>

<span class="sd">        Raises:</span>
<span class="sd">            AttributeError: When the attribute is modified.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geographic_coordinate</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Tuple of the :ref:`dim_api` instances.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dependent_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Tuple of the :ref:`dv_api` instances.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dependent_variables</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">application</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Application metadata dictionary of the CSDM object.</span>

<span class="sd">        .. doctest::</span>

<span class="sd">            &gt;&gt;&gt; print(data.application)</span>
<span class="sd">            {}</span>

<span class="sd">        By default, the application attribute is an empty dictionary, that is,</span>
<span class="sd">        the application metadata stored by the previous application is ignored</span>
<span class="sd">        upon file import.</span>

<span class="sd">        The application metadata may, however, be retained with a request via</span>
<span class="sd">        the :meth:`~csdmpy.load` method. This feature may be useful to related</span>
<span class="sd">        applications where application metadata might contain additional information.</span>
<span class="sd">        The attribute may be updated with a python dictionary.</span>

<span class="sd">        The application attribute is where an application can place its own</span>
<span class="sd">        metadata as a python dictionary object containing application specific</span>
<span class="sd">        metadata, using a reverse domain name notation string as the attribute</span>
<span class="sd">        key, for example,</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; data.application = {</span>
<span class="sd">            ...     &quot;com.example.myApp&quot; : {</span>
<span class="sd">            ...         &quot;myApp_key&quot;: &quot;myApp_metadata&quot;</span>
<span class="sd">            ...      }</span>
<span class="sd">            ... }</span>
<span class="sd">            &gt;&gt;&gt; print(data.application)</span>
<span class="sd">            {&#39;com.example.myApp&#39;: {&#39;myApp_key&#39;: &#39;myApp_metadata&#39;}}</span>

<span class="sd">        Returns:</span>
<span class="sd">            Python dictionary object with the application metadata.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_application</span>

    <span class="nd">@application</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">application</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_application</span> <span class="o">=</span> <span class="n">validate</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;application&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Json serialized string describing the CSDM class instance.</span>

<span class="sd">        The data_structure attribute is only intended for a quick preview of</span>
<span class="sd">        the dataset. This JSON serialized string from this attribute avoids</span>
<span class="sd">        displaying large datasets. Do not use the value of this attribute to</span>
<span class="sd">        save the data to a file, instead use the :meth:`~csdmpy.CSDM.save`</span>
<span class="sd">        methods of the instance.</span>

<span class="sd">        Raises:</span>
<span class="sd">            AttributeError: When modified.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dictionary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_dict</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">for_display</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">dictionary</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Local file address of the current file. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>

    <span class="c1"># Numpy - like property</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">real</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a csdm object with only the real part of the dependent variable</span>
<span class="sd">        components.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">imag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a csdm object with only the imaginary part of the dependent variable</span>
<span class="sd">        components.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">T</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a csdm object with a transpose of the dataset.&quot;&quot;&quot;</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">CSDM</span><span class="p">()</span>
        <span class="n">new</span><span class="o">.</span><span class="n">_copy_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># new = self.copy()</span>
        <span class="n">new</span><span class="o">.</span><span class="n">_dimensions</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">:</span>
            <span class="n">dv</span> <span class="o">=</span> <span class="n">empty_dependent_variable</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">numeric_type</span><span class="p">)</span>
            <span class="n">dv</span><span class="o">.</span><span class="n">_copy_metadata</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">dv</span><span class="o">.</span><span class="n">subtype</span><span class="o">.</span><span class="n">_components</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">subtype</span><span class="o">.</span><span class="n">_components</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">new</span><span class="o">.</span><span class="n">_dependent_variables</span> <span class="o">+=</span> <span class="p">[</span><span class="n">dv</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">new</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the count along each dimension of the csdm objects as a</span>
<span class="sd">        tuple.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">item</span><span class="o">.</span><span class="n">count</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ndim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the total number of dimensions.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------- #</span>
    <span class="c1">#                                  Methods                                #</span>
    <span class="c1"># ----------------------------------------------------------------------- #</span>

<div class="viewcode-block" id="CSDM.add_dimension"><a class="viewcode-back" href="../../api/CSDM.html#csdmpy.CSDM.add_dimension">[docs]</a>    <span class="k">def</span> <span class="nf">add_dimension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a new :ref:`dim_api` instance to the :ref:`csdm_api` object.</span>

<span class="sd">        There are several ways to add a new independent variable.</span>

<span class="sd">        *From a python dictionary containing valid keywords.*</span>

<span class="sd">        .. doctest::</span>

<span class="sd">            &gt;&gt;&gt; import csdmpy as cp</span>
<span class="sd">            &gt;&gt;&gt; datamodel = cp.new()</span>
<span class="sd">            &gt;&gt;&gt; py_dictionary = {</span>
<span class="sd">            ...     &#39;type&#39;: &#39;linear&#39;,</span>
<span class="sd">            ...     &#39;increment&#39;: &#39;5 G&#39;,</span>
<span class="sd">            ...     &#39;count&#39;: 50,</span>
<span class="sd">            ...     &#39;coordinates_offset&#39;: &#39;-10 mT&#39;</span>
<span class="sd">            ... }</span>
<span class="sd">            &gt;&gt;&gt; datamodel.add_dimension(py_dictionary)</span>

<span class="sd">        *Using keyword as the arguments.*</span>

<span class="sd">        .. doctest::</span>

<span class="sd">            &gt;&gt;&gt; datamodel.add_dimension(</span>
<span class="sd">            ...     type = &#39;linear&#39;,</span>
<span class="sd">            ...     increment = &#39;5 G&#39;,</span>
<span class="sd">            ...     count = 50,</span>
<span class="sd">            ...     coordinates_offset = &#39;-10 mT&#39;</span>
<span class="sd">            ... )</span>

<span class="sd">        *Using a* :ref:`dim_api` *class.*</span>

<span class="sd">        .. doctest::</span>

<span class="sd">            &gt;&gt;&gt; var1 = Dimension(type = &#39;linear&#39;,</span>
<span class="sd">            ...                  increment = &#39;5 G&#39;,</span>
<span class="sd">            ...                  count = 50,</span>
<span class="sd">            ...                  coordinates_offset = &#39;-10 mT&#39;)</span>
<span class="sd">            &gt;&gt;&gt; datamodel.add_dimension(var1)</span>

<span class="sd">        *Using a subtype class.*</span>

<span class="sd">        .. doctest::</span>

<span class="sd">            &gt;&gt;&gt; var2 = cp.LinearDimension(count = 50,</span>
<span class="sd">            ...                  increment = &#39;5 G&#39;,</span>
<span class="sd">            ...                  coordinates_offset = &#39;-10 mT&#39;)</span>
<span class="sd">            &gt;&gt;&gt; datamodel.add_dimension(var2)</span>

<span class="sd">        *From a numpy array.*</span>

<span class="sd">        .. doctest::</span>

<span class="sd">            &gt;&gt;&gt; array = np.arange(50)</span>
<span class="sd">            &gt;&gt;&gt; dim = cp.as_dimension(array)</span>
<span class="sd">            &gt;&gt;&gt; datamodel.add_dimension(dim)</span>

<span class="sd">        In the third and fourth example, the instances, ``var1`` and ``var2`` are added</span>
<span class="sd">        to the ``datamodel`` as a reference, `i.e.`, if the instance ``var1`` or</span>
<span class="sd">        ``var2`` is destroyed, the ``datamodel`` instance will become corrupt. As a</span>
<span class="sd">        recommendation, always pass a copy of the :ref:`dim_api` instance to the</span>
<span class="sd">        :meth:`~csdmpy.CSDM.add_dimension` method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">args</span> <span class="o">!=</span> <span class="p">()</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">__dimensions_list__</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span> <span class="o">+=</span> <span class="p">[</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span> <span class="o">+=</span> <span class="p">[</span><span class="n">Dimension</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)]</span></div>

<div class="viewcode-block" id="CSDM.add_dependent_variable"><a class="viewcode-back" href="../../api/CSDM.html#csdmpy.CSDM.add_dependent_variable">[docs]</a>    <span class="k">def</span> <span class="nf">add_dependent_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a new :ref:`dv_api` instance to the :ref:`csdm_api` instance.</span>

<span class="sd">        There are again several ways to add a new dependent variable instance.</span>

<span class="sd">        *From a python dictionary containing valid keywords.*</span>

<span class="sd">        .. doctest::</span>

<span class="sd">            &gt;&gt;&gt; import numpy as np</span>

<span class="sd">            &gt;&gt;&gt; datamodel = cp.new()</span>

<span class="sd">            &gt;&gt;&gt; numpy_array = (100*np.random.rand(3,50)).astype(np.uint8)</span>
<span class="sd">            &gt;&gt;&gt; py_dictionary = {</span>
<span class="sd">            ...     &#39;type&#39;: &#39;internal&#39;,</span>
<span class="sd">            ...     &#39;components&#39;: numpy_array,</span>
<span class="sd">            ...     &#39;name&#39;: &#39;star&#39;,</span>
<span class="sd">            ...     &#39;unit&#39;: &#39;W s&#39;,</span>
<span class="sd">            ...     &#39;quantity_name&#39;: &#39;energy&#39;,</span>
<span class="sd">            ...     &#39;quantity_type&#39;: &#39;pixel_3&#39;</span>
<span class="sd">            ... }</span>
<span class="sd">            &gt;&gt;&gt; datamodel.add_dependent_variable(py_dictionary)</span>

<span class="sd">        *From a list of valid keyword arguments.*</span>

<span class="sd">        .. doctest::</span>

<span class="sd">            &gt;&gt;&gt; datamodel.add_dependent_variable(type=&#39;internal&#39;,</span>
<span class="sd">            ...                                  name=&#39;star&#39;,</span>
<span class="sd">            ...                                  unit=&#39;W s&#39;,</span>
<span class="sd">            ...                                  quantity_type=&#39;pixel_3&#39;,</span>
<span class="sd">            ...                                  components=numpy_array)</span>

<span class="sd">        *From a* :ref:`dv_api` *instance.*</span>

<span class="sd">        .. doctest::</span>

<span class="sd">            &gt;&gt;&gt; from csdmpy import DependentVariable</span>
<span class="sd">            &gt;&gt;&gt; var1 = DependentVariable(type=&#39;internal&#39;,</span>
<span class="sd">            ...                          name=&#39;star&#39;,</span>
<span class="sd">            ...                          unit=&#39;W s&#39;,</span>
<span class="sd">            ...                          quantity_type=&#39;pixel_3&#39;,</span>
<span class="sd">            ...                          components=numpy_array)</span>
<span class="sd">            &gt;&gt;&gt; datamodel.add_dependent_variable(var1)</span>

<span class="sd">        If passing a :ref:`dv_api` instance, as a general recommendation,</span>
<span class="sd">        always pass a copy of the DependentVariable instance to the</span>
<span class="sd">        :meth:`~csdmpy.add_dependent_variable` method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">args</span> <span class="o">!=</span> <span class="p">()</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">DependentVariable</span><span class="p">):</span>
            <span class="n">dv</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dv</span> <span class="o">=</span> <span class="n">DependentVariable</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">dv</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="s2">&quot;base64&quot;</span>
            <span class="n">dv</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s2">&quot;internal&quot;</span>

        <span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">if</span> <span class="n">shape</span> <span class="o">!=</span> <span class="p">():</span>
            <span class="n">dv</span><span class="o">.</span><span class="n">_reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dependent_variables</span> <span class="o">+=</span> <span class="p">[</span><span class="n">dv</span><span class="p">]</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="CSDM.to_dict"><a class="viewcode-back" href="../../api/CSDM.html#csdmpy.CSDM.to_dict">[docs]</a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">update_timestamp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="n">__latest_CSDM_version__</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Serialize the :ref:`CSDM_api` instance as a python dictionary.</span>

<span class="sd">        Args:</span>
<span class="sd">            update_timestamp(bool): If True, timestamp is updated to current time.</span>
<span class="sd">            read_only (bool): If true, the read_only flag is set true.</span>
<span class="sd">            version (str): Serialize the dict with the given csdm version.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; data.to_dict() # doctest: +SKIP</span>
<span class="sd">            {&#39;csdm&#39;: {&#39;version&#39;: &#39;1.0&#39;, &#39;timestamp&#39;: &#39;1994-11-05T13:15:30Z&#39;,</span>
<span class="sd">            &#39;geographic_coordinate&#39;: {&#39;latitude&#39;: &#39;10 deg&#39;, &#39;longitude&#39;: &#39;93.2 deg&#39;,</span>
<span class="sd">            &#39;altitude&#39;: &#39;10 m&#39;}, &#39;description&#39;: &#39;A simulated sine curve.&#39;,</span>
<span class="sd">            &#39;dimensions&#39;: [{&#39;type&#39;: &#39;linear&#39;, &#39;description&#39;: &#39;A temporal dimension.&#39;,</span>
<span class="sd">            &#39;count&#39;: 10, &#39;increment&#39;: &#39;0.1 s&#39;, &#39;quantity_name&#39;: &#39;time&#39;,&#39;label&#39;: &#39;time&#39;,</span>
<span class="sd">            &#39;reciprocal&#39;: {&#39;quantity_name&#39;: &#39;frequency&#39;}}], &#39;dependent_variables&#39;:</span>
<span class="sd">            [{&#39;type&#39;: &#39;internal&#39;, &#39;description&#39;: &#39;A response dependent variable.&#39;,</span>
<span class="sd">            &#39;name&#39;: &#39;sine curve&#39;, &#39;encoding&#39;: &#39;base64&#39;, &#39;numeric_type&#39;: &#39;float32&#39;,</span>
<span class="sd">            &#39;quantity_type&#39;: &#39;scalar&#39;, &#39;component_labels&#39;: [&#39;response&#39;],&#39;components&#39;:</span>
<span class="sd">            [&#39;AAAAABh5Fj9xeHM/cXhzPxh5Fj8yMQ0lGHkWv3F4c79xeHO/GHkWvw==&#39;]}]}}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_dict</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_to_dict</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">update_timestamp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">read_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">version</span><span class="o">=</span><span class="n">__latest_CSDM_version__</span><span class="p">,</span>
        <span class="n">for_display</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">dictionary</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_only</span><span class="p">:</span>
            <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;read_only&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_only</span>

        <span class="k">if</span> <span class="n">update_timestamp</span><span class="p">:</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()[:</span><span class="o">-</span><span class="mi">7</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;Z&quot;</span>
            <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timestamp</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geographic_coordinate</span> <span class="o">!=</span> <span class="p">{}:</span>
            <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;geographic_coordinate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geographic_coordinate</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;tags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span>
        <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;dimensions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;dependent_variables&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">)):</span>
            <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;dimensions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>

        <span class="n">_length_of_dependent_variables</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">_length_of_dependent_variables</span><span class="p">):</span>
            <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;dependent_variables&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">_to_dict</span><span class="p">(</span>
                    <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                    <span class="n">dataset_index</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
                    <span class="n">for_display</span><span class="o">=</span><span class="n">for_display</span><span class="p">,</span>
                    <span class="n">version</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__latest_CSDM_version__</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="n">csdm</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">csdm</span><span class="p">[</span><span class="s2">&quot;csdm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dictionary</span>
        <span class="k">return</span> <span class="n">csdm</span>

<div class="viewcode-block" id="CSDM.dumps"><a class="viewcode-back" href="../../api/CSDM.html#csdmpy.CSDM.dumps">[docs]</a>    <span class="k">def</span> <span class="nf">dumps</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">update_timestamp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="n">__latest_CSDM_version__</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Serialize the :ref:`CSDM_api` instance as a JSON data-exchange string.</span>

<span class="sd">        Args:</span>
<span class="sd">            update_timestamp(bool): If True, timestamp is updated to current time.</span>
<span class="sd">            read_only (bool): If true, the file is serialized as read_only.</span>
<span class="sd">            version (str): The file is serialized with the given CSD model version.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; data.dumps()  # doctest: +SKIP</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_to_dict</span><span class="p">(</span><span class="n">update_timestamp</span><span class="p">,</span> <span class="n">read_only</span><span class="p">,</span> <span class="n">version</span><span class="p">),</span>
            <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">sort_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">allow_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="CSDM.save"><a class="viewcode-back" href="../../api/CSDM.html#csdmpy.CSDM.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">read_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">version</span><span class="o">=</span><span class="n">__latest_CSDM_version__</span><span class="p">,</span>
        <span class="n">output_device</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Serialize the :ref:`CSDM_api` instance as a JSON data-exchange file.</span>

<span class="sd">        There are two types of file serialization extensions, `.csdf` and</span>
<span class="sd">        `.csdfe`. In the CSD model, when every instance of the DependentVariable</span>
<span class="sd">        objects from a CSDM class has an `internal` subtype, the corresponding</span>
<span class="sd">        CSDM instance is serialized with a `.csdf` file extension.</span>
<span class="sd">        If any single DependentVariable instance has an `external` subtype, the</span>
<span class="sd">        CSDM instance is serialized with a `.csdfe` file extension.</span>
<span class="sd">        The two different file extensions are used to alert the end-user of the</span>
<span class="sd">        possible deserialization error associated with the `.csdfe` file</span>
<span class="sd">        extensions had the external data file becomes inaccessible.</span>

<span class="sd">        In `csdmpy`, however, irrespective of the dependent variable subtypes</span>
<span class="sd">        from the serialized JSON file, by default, all instances of</span>
<span class="sd">        DependentVariable class are treated an `internal` after import.</span>
<span class="sd">        Therefore, when serialized, the CSDM object should be stored as a `.csdf`</span>
<span class="sd">        file.</span>

<span class="sd">        To store a file as a `.csdfe` file, the user much set the value of</span>
<span class="sd">        the :attr:`~csdmpy.DependentVariable.encoding`</span>
<span class="sd">        attribute from the dependent variables to ``raw``.</span>
<span class="sd">        In which case, a binary file named `filename_i.dat` will be generated</span>
<span class="sd">        where :math:`i` is the :math:`i^\\text{th}` dependent variable.</span>
<span class="sd">        The parameter `filename` is an argument of this method.</span>

<span class="sd">        .. note:: Only dependent variables with ``encoding=&quot;raw&quot;`` will be</span>
<span class="sd">            serialized to a binary file.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename (str): The filename of the serialized file.</span>
<span class="sd">            read_only (bool): If true, the file is serialized as read_only.</span>
<span class="sd">            version (str): The file is serialized with the given CSD model version.</span>
<span class="sd">            output_device(object): Object where the data is written. If provided,</span>
<span class="sd">                the argument `filename` become irrelevant.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; data.save(&#39;my_file.csdf&#39;)</span>

<span class="sd">        .. testcleanup::</span>
<span class="sd">            import os</span>
<span class="sd">            os.remove(&#39;my_file.csdf&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dictionary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_dict</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="n">version</span><span class="p">)</span>

        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()[:</span><span class="o">-</span><span class="mi">7</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;Z&quot;</span>
        <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;csdm&quot;</span><span class="p">][</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timestamp</span>

        <span class="k">if</span> <span class="n">read_only</span><span class="p">:</span>
            <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;csdm&quot;</span><span class="p">][</span><span class="s2">&quot;read_only&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">read_only</span>

        <span class="k">if</span> <span class="n">output_device</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
                    <span class="n">dictionary</span><span class="p">,</span>
                    <span class="n">outfile</span><span class="p">,</span>
                    <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">sort_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                    <span class="n">allow_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
                <span class="n">dictionary</span><span class="p">,</span>
                <span class="n">output_device</span><span class="p">,</span>
                <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">sort_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">allow_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">to_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the dimension coordinates and dependent variable components as</span>
<span class="sd">        a list of numpy arrays.&quot;&quot;&quot;</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">coordinates</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">]</span>
        <span class="n">dep</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependent_variables</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">components</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">[</span><span class="o">*</span><span class="n">dim</span><span class="p">,</span> <span class="o">*</span><span class="n">dep</span><span class="p">]</span>

<div class="viewcode-block" id="CSDM.astype"><a class="viewcode-back" href="../../api/CSDM.html#csdmpy.CSDM.astype">[docs]</a>    <span class="k">def</span> <span class="nf">astype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">numeric_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a copy of the CSDM object by converting the numeric type of each</span>
<span class="sd">        dependent variables components to the given value.</span>

<span class="sd">        Args:</span>
<span class="sd">            numeric_type: A numpy dtype or a string with a valid numeric type</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; data_32 = data_64.astype(&#39;float32&#39;)  # doctest: +SKIP</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">copy_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">copy_</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">:</span>
            <span class="n">var</span><span class="o">.</span><span class="n">numeric_type</span> <span class="o">=</span> <span class="n">numeric_type</span>
        <span class="k">return</span> <span class="n">copy_</span></div>

<div class="viewcode-block" id="CSDM.copy"><a class="viewcode-back" href="../../api/CSDM.html#csdmpy.CSDM.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a copy of the current CSDM instance.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A CSDM instance.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; data.copy()  # doctest: +SKIP</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="CSDM.split"><a class="viewcode-back" href="../../api/CSDM.html#csdmpy.CSDM.split">[docs]</a>    <span class="k">def</span> <span class="nf">split</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Split the dependent-variables into view of individual csdm objects.</span>

<span class="sd">        Return:</span>
<span class="sd">            A list of CSDM objects, each with one dependent variable. The</span>
<span class="sd">            objects are returned as a view.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # data contains two dependent variables</span>
<span class="sd">            &gt;&gt;&gt; d1, d2 = data.split()  #doctest: +SKIP</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">new_object</span><span class="p">():</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">CSDM</span><span class="p">()</span>
            <span class="n">a</span><span class="o">.</span><span class="n">_dimensions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span>
            <span class="n">a</span><span class="o">.</span><span class="n">_dependent_variables</span> <span class="o">=</span> <span class="n">DependentVariableList</span><span class="p">([])</span>
            <span class="n">a</span><span class="o">.</span><span class="n">_tags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span>
            <span class="n">a</span><span class="o">.</span><span class="n">_read_only</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_only</span>
            <span class="n">a</span><span class="o">.</span><span class="n">_version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version</span>
            <span class="n">a</span><span class="o">.</span><span class="n">_timestamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timestamp</span>
            <span class="n">a</span><span class="o">.</span><span class="n">_geographic_coordinate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geographic_coordinate</span>
            <span class="n">a</span><span class="o">.</span><span class="n">_description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_description</span>
            <span class="n">a</span><span class="o">.</span><span class="n">_application</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_application</span>
            <span class="n">a</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>
            <span class="k">return</span> <span class="n">a</span>

        <span class="n">dv</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">new_object</span><span class="p">()</span>
            <span class="n">a</span><span class="o">.</span><span class="n">_dependent_variables</span> <span class="o">+=</span> <span class="p">[</span><span class="n">variable</span><span class="p">]</span>
            <span class="n">dv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dv</span></div>

    <span class="c1"># ----------------------------------------------------------------------- #</span>
    <span class="c1">#                            NumPy-like functions                         #</span>
    <span class="c1"># ----------------------------------------------------------------------- #</span>
<div class="viewcode-block" id="CSDM.max"><a class="viewcode-back" href="../../api/CSDM.html#csdmpy.CSDM.max">[docs]</a>    <span class="k">def</span> <span class="nf">max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a csdm object with the maximum dependent variable component along a</span>
<span class="sd">        given axis.</span>

<span class="sd">        Args:</span>
<span class="sd">            axis: An integer or None or a tuple of `m` integers cooresponding to</span>
<span class="sd">                    the index/indices of dimensions along which the sum of the</span>
<span class="sd">                    dependent variable components is performed. If None, the output is</span>
<span class="sd">                    the sum over all dimensions per dependent variable.</span>
<span class="sd">        Return:</span>
<span class="sd">            A CSDM object with `m` dimensions removed, or a numpy array when dimension</span>
<span class="sd">            is None.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; data2 = data.max()  #doctest: +SKIP</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">argmax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="CSDM.min"><a class="viewcode-back" href="../../api/CSDM.html#csdmpy.CSDM.min">[docs]</a>    <span class="k">def</span> <span class="nf">min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a csdm object with the minimum dependent variable component along a</span>
<span class="sd">        given axis.</span>

<span class="sd">        Args:</span>
<span class="sd">            axis: An integer or None or a tuple of `m` integers cooresponding to</span>
<span class="sd">                    the index/indices of dimensions along which the sum of the</span>
<span class="sd">                    dependent variable components is performed. If None, the output is</span>
<span class="sd">                    over all dimensions per dependent variable.</span>
<span class="sd">        Return:</span>
<span class="sd">            A CSDM object with `m` dimensions removed, or a list when `axis` is None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">argmin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ptp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="CSDM.clip"><a class="viewcode-back" href="../../api/CSDM.html#csdmpy.CSDM.clip">[docs]</a>    <span class="k">def</span> <span class="nf">clip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clip the dependent variable components between the `min` and `max` values.</span>

<span class="sd">        Args:</span>
<span class="sd">            min: The minimum clip value.</span>
<span class="sd">            max: The maximum clip value.</span>

<span class="sd">        Return:</span>
<span class="sd">            A CSDM object with values clipped between min and max.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s2">&quot;CSDM objects with more that one dependent variable does not support &quot;</span>
                <span class="s2">&quot;the clip method. Used `.split()` method to split the dependent &quot;</span>
                <span class="s2">&quot;variables into individual csdm objects and try again.&quot;</span>
            <span class="p">)</span>
        <span class="n">a_max</span> <span class="o">=</span> <span class="nb">max</span>
        <span class="k">if</span> <span class="nb">max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">a_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">a_min</span> <span class="o">=</span> <span class="nb">min</span>
        <span class="k">if</span> <span class="nb">min</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">a_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_min</span><span class="p">,</span> <span class="n">a_max</span><span class="p">)</span></div>

<div class="viewcode-block" id="CSDM.conj"><a class="viewcode-back" href="../../api/CSDM.html#csdmpy.CSDM.conj">[docs]</a>    <span class="k">def</span> <span class="nf">conj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a csdm object with the complex conjugate of all dependent variable</span>
<span class="sd">        components.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="CSDM.round"><a class="viewcode-back" href="../../api/CSDM.html#csdmpy.CSDM.round">[docs]</a>    <span class="k">def</span> <span class="nf">round</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a csdm object by rounding the dependent variable components to the</span>
<span class="sd">        given `decimals`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">decimals</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">axis1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">axis2</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="CSDM.sum"><a class="viewcode-back" href="../../api/CSDM.html#csdmpy.CSDM.sum">[docs]</a>    <span class="k">def</span> <span class="nf">sum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a csdm object with the sum of the dependent variable components over</span>
<span class="sd">        a given `dimension=axis`.</span>

<span class="sd">        Args:</span>
<span class="sd">            axis: An integer or None or a tuple of `m` integers cooresponding to</span>
<span class="sd">                    the index/indices of dimensions along which the sum of the</span>
<span class="sd">                    dependent variable components is performed. If None, the output is</span>
<span class="sd">                    over all dimensions per dependent variable.</span>
<span class="sd">        Return:</span>
<span class="sd">            A CSDM object with `m` dimensions removed, or a list when `axis` is None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">cumsum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="CSDM.mean"><a class="viewcode-back" href="../../api/CSDM.html#csdmpy.CSDM.mean">[docs]</a>    <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a csdm object with the mean of the dependent variable components over</span>
<span class="sd">        a given `dimension=axis`.</span>

<span class="sd">        Args:</span>
<span class="sd">            axis: An integer or None or a tuple of `m` integers cooresponding to</span>
<span class="sd">                    the index/indices of dimensions along which the sum of the</span>
<span class="sd">                    dependent variable components is performed. If None, the output is</span>
<span class="sd">                    over all dimensions per dependent variable.</span>
<span class="sd">        Return:</span>
<span class="sd">            A CSDM object with `m` dimensions removed, or a list when `axis` is None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span></div>

<div class="viewcode-block" id="CSDM.var"><a class="viewcode-back" href="../../api/CSDM.html#csdmpy.CSDM.var">[docs]</a>    <span class="k">def</span> <span class="nf">var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a csdm object with the variance of the dependent variable components</span>
<span class="sd">        over a given `dimension=axis`.</span>

<span class="sd">        Args:</span>
<span class="sd">            axis: An integer or None or a tuple of `m` integers cooresponding to</span>
<span class="sd">                    the index/indices of dimensions along which the sum of the</span>
<span class="sd">                    dependent variable components is performed. If None, the output is</span>
<span class="sd">                    over all dimensions per dependent variable.</span>
<span class="sd">        Return:</span>
<span class="sd">            A CSDM object with `m` dimensions removed, or a list when `axis` is None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span></div>

<div class="viewcode-block" id="CSDM.std"><a class="viewcode-back" href="../../api/CSDM.html#csdmpy.CSDM.std">[docs]</a>    <span class="k">def</span> <span class="nf">std</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a csdm object with the standard deviation of the dependent variable</span>
<span class="sd">        components over a given `dimension=axis`.</span>

<span class="sd">        Args:</span>
<span class="sd">            axis: An integer or None or a tuple of `m` integers cooresponding to</span>
<span class="sd">                    the index/indices of dimensions along which the sum of the</span>
<span class="sd">                    dependent variable components is performed. If None, the output is</span>
<span class="sd">                    over all dimensions per dependent variable.</span>
<span class="sd">        Return:</span>
<span class="sd">            A CSDM object with `m` dimensions removed, or a list when `axis` is None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span></div>

<div class="viewcode-block" id="CSDM.prod"><a class="viewcode-back" href="../../api/CSDM.html#csdmpy.CSDM.prod">[docs]</a>    <span class="k">def</span> <span class="nf">prod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a csdm object with the product of the dependent variable components</span>
<span class="sd">        over a given `dimension=axis`.</span>

<span class="sd">        Args:</span>
<span class="sd">            axis: An integer or None or a tuple of `m` integers cooresponding to</span>
<span class="sd">                    the index/indices of dimensions along which the product of the</span>
<span class="sd">                    dependent variable components is performed. If None, the output is</span>
<span class="sd">                    over all dimensions per dependent variable.</span>
<span class="sd">        Return:</span>
<span class="sd">            A CSDM object with `m` dimensions removed, or a list when `axis` is None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">cumprod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># csdm dimension order manipulation</span>
    <span class="k">def</span> <span class="nf">transpose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span>

    <span class="k">def</span> <span class="nf">__array_ufunc__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">*</span><span class="n">inputs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># print(&quot;__array_ufunc__&quot;)</span>
        <span class="c1"># print(inputs)</span>
        <span class="c1"># print(kwargs)</span>

        <span class="n">csdm</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">input_</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">input_</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="k">if</span> <span class="n">function</span> <span class="ow">in</span> <span class="n">__ufunc_list_dimensionless_unit__</span><span class="p">:</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">csdm</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">variable</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">csdm</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">variable</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">physical_type</span> <span class="o">!=</span> <span class="s2">&quot;dimensionless&quot;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="n">f</span><span class="s2">&quot;Cannot apply `</span><span class="si">{function.__name__}</span><span class="s2">` to quantity with physical &quot;</span>
                        <span class="n">f</span><span class="s2">&quot;type `</span><span class="si">{variable.unit.physical_type}</span><span class="s2">`.&quot;</span>
                    <span class="p">)</span>
                <span class="n">factor</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_get_new_csdm_object_after_applying_ufunc</span><span class="p">(</span>
                <span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">function</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">factor</span><span class="p">,</span> <span class="o">*</span><span class="n">input_</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">function</span> <span class="ow">in</span> <span class="n">__ufunc_list_unit_independent__</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_get_new_csdm_object_after_applying_ufunc</span><span class="p">(</span>
                <span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">function</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">input_</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">function</span> <span class="ow">in</span> <span class="n">__ufunc_list_applies_to_unit__</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">_get_new_csdm_object_after_applying_ufunc</span><span class="p">(</span>
                <span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">function</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">input_</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">variable</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">):</span>
                <span class="n">scalar</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="n">variable</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="o">*</span><span class="n">input_</span><span class="p">)</span>
                <span class="n">variable</span><span class="o">.</span><span class="n">components</span> <span class="o">*=</span> <span class="n">scalar</span><span class="o">.</span><span class="n">value</span>
                <span class="n">variable</span><span class="o">.</span><span class="n">subtype</span><span class="o">.</span><span class="n">_unit</span> <span class="o">=</span> <span class="n">scalar</span><span class="o">.</span><span class="n">unit</span>
            <span class="k">return</span> <span class="n">obj</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Function </span><span class="si">{function}</span><span class="s2"> is not implemented.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__array_function__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">types</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># print(&quot;__array_function__&quot;)</span>
        <span class="c1"># print(types)</span>
        <span class="c1"># print(kwargs)</span>
        <span class="c1"># print(function)</span>
        <span class="c1"># print(args)</span>
        <span class="k">if</span> <span class="n">function</span> <span class="ow">in</span> <span class="n">__function_reduction_list__</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_get_new_csdm_object_after_dimension_reduction_func</span><span class="p">(</span>
                <span class="n">function</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">**</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">function</span> <span class="ow">in</span> <span class="n">__other_functions__</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_get_new_csdm_object_after_applying_function</span><span class="p">(</span>
                <span class="n">function</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">**</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">function</span> <span class="ow">in</span> <span class="n">__shape_manipulation_functions__</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;axes&quot;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;axes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;axes&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dim_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dimensions</span><span class="p">)</span>
                <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;axes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">([</span><span class="o">-</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim_len</span><span class="p">)])</span>

            <span class="n">csdm</span> <span class="o">=</span> <span class="n">_get_new_csdm_object_after_applying_function</span><span class="p">(</span>
                <span class="n">function</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">**</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>
            <span class="n">csdm</span><span class="o">.</span><span class="n">_dimensions</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">csdm</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;axes&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">:][</span><span class="n">i</span><span class="p">]]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">csdm</span><span class="o">.</span><span class="n">dimensions</span><span class="p">))</span>
                <span class="p">]</span>
            <span class="p">)</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Function </span><span class="si">{function.__name__}</span><span class="s2"> is not implemented.&quot;</span><span class="p">)</span></div>

    <span class="c1"># def __array_interface__(self, *args, **kwargs):</span>
    <span class="c1">#     print(&quot;__array_interface__&quot;)</span>
    <span class="c1">#     pass</span>

    <span class="c1"># def atleast_1d(self, *args, **kwargs):</span>
    <span class="c1">#     print(args)</span>
    <span class="c1">#     print(kwargs)</span>


<span class="k">def</span> <span class="nf">_check_dimension_indices</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">index</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check the list of indexes to ensure that each index is an integer</span>
<span class="sd">        and within the counts of dimensions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">index</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_correct_index</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{message}</span><span class="s2">, found {type(i)}&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="n">d</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">d</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
                <span class="n">f</span><span class="s2">&quot;The `index` </span><span class="si">{index}</span><span class="s2"> cannot be greater than the total number of &quot;</span>
                <span class="n">f</span><span class="s2">&quot;dimensions - 1, </span><span class="si">{d}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span> <span class="n">i</span>

    <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Index/Indices are expected as integer(s)&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
            <span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_correct_index</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">_correct_index</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">d</span><span class="p">)])</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{message}</span><span class="s2">, found {type(index)}&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_check_for_out</span><span class="p">(</span><span class="n">csdm</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;out&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">csdm</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s2">&quot;Keyword `out` is not implemented for csdm objects with more that &quot;</span>
                <span class="s2">&quot;one dependent variables.&quot;</span>
            <span class="p">)</span>


<span class="k">def</span> <span class="nf">_get_new_csdm_object_after_applying_ufunc</span><span class="p">(</span>
    <span class="n">csdm</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">inputs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform the operation, func, on the components of the dependent variables, and</span>
<span class="sd">    return the corresponding CSDM object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">factor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">csdm</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">))</span>
    <span class="n">axis</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;axis&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;axis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_check_dimension_indices</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">csdm</span><span class="o">.</span><span class="n">dimensions</span><span class="p">),</span> <span class="n">axis</span><span class="p">)</span>

    <span class="n">_check_for_out</span><span class="p">(</span><span class="n">csdm</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">new</span> <span class="o">=</span> <span class="n">CSDM</span><span class="p">()</span>

    <span class="c1"># dimension should be added first so that the dependent variables can be</span>
    <span class="c1"># shaped appropriately.</span>
    <span class="n">new</span><span class="o">.</span><span class="n">_dimensions</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">csdm</span><span class="o">.</span><span class="n">dimensions</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">variable</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">csdm</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">components</span> <span class="o">*</span> <span class="n">factor</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">*</span><span class="n">inputs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="n">empty_dependent_variable</span><span class="p">(</span>
            <span class="n">numeric_type</span><span class="o">=</span><span class="n">y</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">quantity_type</span><span class="o">=</span><span class="n">variable</span><span class="o">.</span><span class="n">quantity_type</span>
        <span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_copy_metadata</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">subtype</span><span class="o">.</span><span class="n">_components</span> <span class="o">=</span> <span class="n">y</span>
        <span class="n">new</span><span class="o">.</span><span class="n">_dependent_variables</span> <span class="o">+=</span> <span class="p">[</span><span class="n">obj</span><span class="p">]</span>
        <span class="c1"># obj = as_dependent_variable(y, quantity_type=variable.quantity_type)</span>
        <span class="c1"># obj._copy_metadata(variable)</span>
        <span class="c1"># new.add_dependent_variable(obj)</span>

    <span class="n">new</span><span class="o">.</span><span class="n">_copy_metadata</span><span class="p">(</span><span class="n">csdm</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new</span>


<span class="k">def</span> <span class="nf">_get_new_csdm_object_after_applying_function</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform the operation, func, on the components of the dependent variables, and</span>
<span class="sd">    return the corresponding CSDM object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">args_</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">csdm</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">args_</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="n">_check_for_out</span><span class="p">(</span><span class="n">csdm</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">new</span> <span class="o">=</span> <span class="n">CSDM</span><span class="p">()</span>

    <span class="c1"># dimension should be added first so that the dependent variables can be</span>
    <span class="c1"># shaped appropriately.</span>
    <span class="n">new</span><span class="o">.</span><span class="n">_dimensions</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">csdm</span><span class="o">.</span><span class="n">dimensions</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">csdm</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">components</span><span class="p">,</span> <span class="o">*</span><span class="n">args_</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">empty_dependent_variable</span><span class="p">(</span>
            <span class="n">numeric_type</span><span class="o">=</span><span class="n">y</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">quantity_type</span><span class="o">=</span><span class="n">variable</span><span class="o">.</span><span class="n">quantity_type</span>
        <span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_copy_metadata</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">subtype</span><span class="o">.</span><span class="n">_components</span> <span class="o">=</span> <span class="n">y</span>
        <span class="n">new</span><span class="o">.</span><span class="n">_dependent_variables</span> <span class="o">+=</span> <span class="p">[</span><span class="n">obj</span><span class="p">]</span>

    <span class="n">new</span><span class="o">.</span><span class="n">_copy_metadata</span><span class="p">(</span><span class="n">csdm</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new</span>


<span class="k">def</span> <span class="nf">_get_new_csdm_object_after_apodization</span><span class="p">(</span><span class="n">csdm</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">index</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform the operation, func, on the components of the dependent variables, and</span>
<span class="sd">    return the corresponding CSDM object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">_check_dimension_indices</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">csdm</span><span class="o">.</span><span class="n">dimensions</span><span class="p">),</span> <span class="n">index</span><span class="p">)</span>

    <span class="n">quantity</span> <span class="o">=</span> <span class="n">string_to_quantity</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>

    <span class="n">apodization_vector_nd</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">index</span><span class="p">:</span>
        <span class="n">dimension_coordinates</span> <span class="o">=</span> <span class="n">csdm</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="o">-</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">coordinates</span>
        <span class="n">function_arguments</span> <span class="o">=</span> <span class="n">quantity</span> <span class="o">*</span> <span class="n">dimension_coordinates</span>

        <span class="k">if</span> <span class="n">function_arguments</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">physical_type</span> <span class="o">!=</span> <span class="s2">&quot;dimensionless&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="n">f</span><span class="s2">&quot;The value of the argument, `arg`, must have the dimensionality &quot;</span>
                <span class="n">f</span><span class="s2">&quot;`1/</span><span class="si">{dimension_coordinates.unit.physical_type}</span><span class="s2">`, instead found &quot;</span>
                <span class="n">f</span><span class="s2">&quot;`</span><span class="si">{quantity.unit.physical_type}</span><span class="s2">`.&quot;</span>
            <span class="p">)</span>
        <span class="n">apodization_vector</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">function_arguments</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="n">apodization_vector_1d</span> <span class="o">=</span> <span class="n">_get_broadcast_shape</span><span class="p">(</span>
            <span class="n">apodization_vector</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">csdm</span><span class="o">.</span><span class="n">dimensions</span><span class="p">),</span> <span class="n">i</span>
        <span class="p">)</span>
        <span class="n">apodization_vector_nd</span> <span class="o">=</span> <span class="n">apodization_vector_nd</span> <span class="o">*</span> <span class="n">apodization_vector_1d</span>

    <span class="n">new</span> <span class="o">=</span> <span class="n">CSDM</span><span class="p">()</span>

    <span class="c1"># dimension should be added first so that the dependent variables can be</span>
    <span class="c1"># shaped appropriately.</span>
    <span class="n">new</span><span class="o">.</span><span class="n">_dimensions</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">csdm</span><span class="o">.</span><span class="n">dimensions</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">csdm</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">components</span> <span class="o">*</span> <span class="n">apodization_vector_nd</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="n">empty_dependent_variable</span><span class="p">(</span>
            <span class="n">numeric_type</span><span class="o">=</span><span class="n">y</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">quantity_type</span><span class="o">=</span><span class="n">variable</span><span class="o">.</span><span class="n">quantity_type</span>
        <span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_copy_metadata</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">subtype</span><span class="o">.</span><span class="n">_components</span> <span class="o">=</span> <span class="n">y</span>
        <span class="n">new</span><span class="o">.</span><span class="n">_dependent_variables</span> <span class="o">+=</span> <span class="p">[</span><span class="n">obj</span><span class="p">]</span>

        <span class="c1"># obj = as_dependent_variable(y, quantity_type=variable.quantity_type)</span>
        <span class="c1"># obj._copy_metadata(variable)</span>
        <span class="c1"># new.add_dependent_variable(obj)</span>

    <span class="n">new</span><span class="o">.</span><span class="n">_copy_metadata</span><span class="p">(</span><span class="n">csdm</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new</span>


<span class="k">def</span> <span class="nf">_get_new_csdm_object_after_dimension_reduction_func</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform the operation, func, on the components of the dependent variables, and</span>
<span class="sd">    return the corresponding CSDM object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">axis</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">args_</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="p">():</span>
        <span class="n">csdm</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">args_</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">args_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_check_dimension_indices</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">csdm</span><span class="o">.</span><span class="n">dimensions</span><span class="p">),</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">axis</span> <span class="o">=</span> <span class="n">args_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="s2">&quot;a&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">csdm</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;axis&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;axis&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">axis</span> <span class="o">=</span> <span class="n">_check_dimension_indices</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">csdm</span><span class="o">.</span><span class="n">dimensions</span><span class="p">),</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;axis&quot;</span><span class="p">])</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;axis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">axis</span>

    <span class="n">_check_for_out</span><span class="p">(</span><span class="n">csdm</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">new</span> <span class="o">=</span> <span class="n">CSDM</span><span class="p">()</span>
    <span class="n">lst</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># dimension should be added first so that the dependent variables can be</span>
    <span class="c1"># shaped appropriately.</span>
    <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">variable</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">csdm</span><span class="o">.</span><span class="n">dimensions</span><span class="p">):</span>
            <span class="k">if</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">axis</span><span class="p">:</span>
                <span class="n">new</span><span class="o">.</span><span class="n">add_dimension</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>

    <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">csdm</span><span class="o">.</span><span class="n">dependent_variables</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">components</span><span class="p">,</span> <span class="o">*</span><span class="n">args_</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">empty_dependent_variable</span><span class="p">(</span>
                <span class="n">numeric_type</span><span class="o">=</span><span class="n">y</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">quantity_type</span><span class="o">=</span><span class="n">variable</span><span class="o">.</span><span class="n">quantity_type</span>
            <span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_copy_metadata</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">subtype</span><span class="o">.</span><span class="n">_components</span> <span class="o">=</span> <span class="n">y</span>
            <span class="n">new</span><span class="o">.</span><span class="n">_dependent_variables</span> <span class="o">+=</span> <span class="p">[</span><span class="n">obj</span><span class="p">]</span>

            <span class="c1"># obj = as_dependent_variable(y, quantity_type=variable.quantity_type)</span>
            <span class="c1"># obj._copy_metadata(variable)</span>
            <span class="c1"># new.add_dependent_variable(obj)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="n">variable</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">new</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">lst</span>
        <span class="k">return</span> <span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">new</span><span class="o">.</span><span class="n">_copy_metadata</span><span class="p">(</span><span class="n">csdm</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new</span>


<span class="k">def</span> <span class="nf">empty_dependent_variable</span><span class="p">(</span><span class="n">numeric_type</span><span class="p">,</span> <span class="n">quantity_type</span><span class="o">=</span><span class="s2">&quot;scalar&quot;</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">DependentVariable</span><span class="p">(</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;internal&quot;</span><span class="p">,</span>
        <span class="n">components</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">quantity_type</span><span class="o">=</span><span class="n">quantity_type</span><span class="p">,</span>
        <span class="n">numeric_type</span><span class="o">=</span><span class="n">numeric_type</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>

                </div>
              </div>
            </div>
          </div>
        </div>
        
        
      </div><!-- /row -->

      <!-- row -->
      <div class="row footer-relbar">
<div id="navbar-related" class=" related navbar navbar-inverse" role="navigation" aria-label="related navigation">
  <div class="navbar-inner">
    <ul class="nav navbar-nav ">
        <li><a href="../../index.html">csdmpy 0.2 documentation</a></li>
    </ul>
<ul class="nav navbar-nav pull-right hidden-xs hidden-sm">
      
        <li><a href="../../genindex.html" title="General Index" >index</a></li>
        <li><a href="../index.html" >Module code</a></li>
        <li><a href="../csdmpy.html" >csdmpy</a></li>
        <li><a href="#">top</a></li> 
      
    </ul>
  </div>
</div>
      </div><!-- /row -->

      <!-- footer -->
      <footer role="contentinfo">
          &copy; Copyright 2019-2020, The CSDMpy project..
        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 2.2.1.
      </footer>
      <!-- /footer -->

    </div>
    <!-- /container -->

  </body>
</html>
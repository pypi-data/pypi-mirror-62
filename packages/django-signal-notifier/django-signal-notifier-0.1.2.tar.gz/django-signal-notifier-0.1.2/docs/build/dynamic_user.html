

<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Dynamic User &mdash; django_signal_notifier 0.1.0 documentation</title>
  

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Background Tasks" href="background_task.html" />
    <link rel="prev" title="Backends" href="backends.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> django_signal_notifier
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="backends.html">Backends</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Dynamic User</a></li>
<li class="toctree-l1"><a class="reference internal" href="background_task.html">Background Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="settings.html">Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="comparison.html">Comparison with similar projects</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">django_signal_notifier</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Dynamic User</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/dynamic_user.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="dynamic-user">
<h1>Dynamic User<a class="headerlink" href="#dynamic-user" title="Permalink to this headline">¶</a></h1>
<p>You can choose some users and groups as the receiver of the message in the subscription model.
Although there are many conditions that we want to set the receiver user dynamically.
First, let’s take a look at a scenario. Then we present the solution to the problem.
Assume there are two models, <code class="docutils literal notranslate"><span class="pre">Movie</span></code> and <code class="docutils literal notranslate"><span class="pre">User</span></code>.
We want to notify the audiences (<a href="#id1"><span class="problematic" id="id2">``</span></a>user``s) of a movie when it releases.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Movie</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
    <span class="n">audiences</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="n">User</span><span class="p">)</span>
</pre></div>
</div>
<p>You probably defined a custom signal (e.g., <em>notify_audiences</em> ) that you call it(<a class="reference external" href="https://docs.djangoproject.com/en/3.0/topics/signals/#sending-signals">send or send_rebust function</a>)
when you want to notify the audiences. So we don’t discuss details of <code class="docutils literal notranslate"><span class="pre">Trigger</span></code> creation and the related process
that occurs in <strong>DSN</strong> anymore. (Refer to <a class="reference internal" href="introduction.html"><span class="doc">introduction</span></a> ).</p>
<p>The custom signal can be</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">notify_audiences</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="n">providing_args</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;movie&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p><em>movie</em> parameter is used to pass the movie object.</p>
<p>To specify the dynamic user, A messenger must be designed as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Notify_audiences_messenger</span><span class="p">(</span><span class="n">BaseMessenger</span><span class="p">):</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">users</span><span class="p">,</span> <span class="n">trigger_context</span><span class="p">,</span> <span class="n">signal_kwargs</span><span class="p">):</span>
        <span class="c1"># Ignore the messenger when movie was not specified.</span>
        <span class="c1"># We did it to avoid calling this messenger by other asymmetric signals other than notify_audiences</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">movie</span> <span class="o">=</span> <span class="n">signal_kwargs</span><span class="p">[</span><span class="s1">&#39;movie&#39;</span><span class="p">]</span>
            <span class="n">audiences</span> <span class="o">=</span> <span class="n">movie</span><span class="o">.</span><span class="n">audiences</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: Specified signal and Notify_audiences_messenger as backend don&#39;t match together.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">audiences</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">trigger_context</span><span class="o">=</span><span class="n">trigger_context</span><span class="p">,</span> <span class="n">signal_kwargs</span><span class="o">=</span><span class="n">signal_kwargs</span><span class="p">)</span>

            <span class="c1"># Send the rendered message to the user</span>
            <span class="o">...</span>
</pre></div>
</div>
<p>As you see, the <code class="docutils literal notranslate"><span class="pre">users</span></code> argument(the set receivers in the subscription) is ignored, and a new user list is created. If you want to send the message to the preset receivers too, you can combine <code class="docutils literal notranslate"><span class="pre">users</span></code> and <code class="docutils literal notranslate"><span class="pre">audiences</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">user</span></code> parameter that template is rendered by, must be the type of <code class="docutils literal notranslate"><span class="pre">AUTH_USER_MODEL</span></code> (Refer to <a class="reference internal" href="settings.html"><span class="doc">settings</span></a>)</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="background_task.html" class="btn btn-neutral float-right" title="Background Tasks" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="backends.html" class="btn btn-neutral float-left" title="Backends" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Mohammad Hadi Azaddel

    </p>
  </div>
    
    
      Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>
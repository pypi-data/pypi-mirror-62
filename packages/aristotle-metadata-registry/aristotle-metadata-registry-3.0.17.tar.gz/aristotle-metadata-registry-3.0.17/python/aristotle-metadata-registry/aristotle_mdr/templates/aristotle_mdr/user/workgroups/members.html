{% extends "aristotle_mdr/user/workgroups/base.html" %}
{% load aristotle_tags i18n %}
{% url 'aristotle:item' item.id %}

{% block title %}{{ workgroup.name }} {% trans 'members' %}{% endblock %}

{% block workgroup_page %}
{% has_group_perm workgroup "edit_members" as can_edit_members %}
{% has_group_perm workgroup "view_members" as can_view_members %}

    <div>
    </div>

    <div class="panel panel-default">
        <div class="panel-heading">
            <div class="row">

                    <div class="btn-group pull-right" role="group">
                        {% if user in workgroup.member_list %}
                            <a href="{% url 'aristotle:workgroup_leave' workgroup.id %}" class="btn btn-warning"><i
                                    class="fa fa-user-times"></i> {% trans 'Leave Workgroup'%}</a>
                        {% endif %}
                        {% if can_edit_members %}
                            <a class="btn btn-default" href="{% url 'aristotle:addWorkgroupMembers' item.pk %}"
                               data-toggle="modal" data-target="#wg_page_modal">Add a user</a>
                        {% endif %}
                    </div>

            </div>
        </div>

        <table class="table">
            <thead>
            <tr>
                <th>Member</th>
                <th>Roles</th>
                {% if can_edit_members %}
                <th>Manage</th>
                {% endif %}
            </tr>
            </thead>
            <tbody>

            {% for member in item.members.all %}
                <tr>
                    <td>
                        {% include "aristotle_mdr/users_management/helper/user_table_display.html" with user=member.user %}
                    </td>
                    <td>
                        {{ member.role }}
                    </td>
                    {% if can_edit_members %}
                    <td>
                        <div class="btn-group">
                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"
                                    aria-haspopup="true" aria-expanded="false">
                                <i class="fa fa-cog"></i>
                                <span class="sr-only">Manage permissions for {{ member.user }}</span>
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu pull-right">
                                <li>
                                    <a href="{% url 'aristotle:workgroup_member_change_role' item.id  member.user.pk %}"
                                       data-toggle="modal" data-target="#wg_page_modal">Change roles</a>
                                </li>
                                <li role="separator" class="divider"></li>
                                <li class="alert-danger">
                                    <a href="{% url 'aristotle:workgroup_member_remove' item.id  member.user.pk %}"
                                       data-toggle="modal" data-target="#wg_page_modal">Remove from this group</a>
                                </li>
                            </ul>
                        </div>
                    </td>
                    {% endif %}
                </tr>
            {% empty %}
                <tr>
                    <td>No members</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    <header>About workgroup roles:</header>

    <p>
        Above is a list of members in this workgroup, every person listed on this page can view content in
        this workgroup. Additional permissions are listed with each group.
        Permissions only apply to specific workgroup, so a user may be a manager in one group but
        an editor in another.<br>
        All members of a workgroup can participate in workgroup conversations.
    </p>

    <p>
    <dl>
        <dt>Managers</dt>
        <dd>
            Workgroup managers can add and remove users from a workgroup, delete workgroup
            conversations and retire a workgroup. They can also create metadata and edit metadata
            <em>that has been not progressed to a locked state</em>.
        </dd>

        <dt>Stewards</dt>
        <dd>
            Stewards are trusted editors that can create and edit content that has been
            progressed to a locked state.
        </dd>

        <dt>Submitters</dt>
        <dd>
            Submitters can edit content that has not been progressed by a registrar to a locked state.
            They can view all content in a workgroup and can set the flag that an item is ready for review by a registrar.
        </dd>

        <dt>Viewers</dt>
        <dd>
            Viewers are only able to view content in a workgroup. They may also participate in workgroup conversations.
        </dd>
    </dl>

    {% bootstrap_modal "wg_page_modal" %}

{% endblock %}


<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>EPICS support in pyexpander &#8212; pyexpander 1.9.2 documentation</title>
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="pyexpander for users not familiar with python version 3" href="python3.html" />
    <link rel="prev" title="pyexpander reference" href="reference-expander.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="python3.html" title="pyexpander for users not familiar with python version 3"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="reference-expander.html" title="pyexpander reference"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">pyexpander 1.9.2 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="epics-support-in-pyexpander">
<h1>EPICS support in pyexpander<a class="headerlink" href="#epics-support-in-pyexpander" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="http://www.aps.anl.gov/epics">EPICS</a> is a framework for control systems
used at many research facilities, including the
<a class="reference external" href="https://www.helmholtz-berlin.de">Helmholtz-Zentrum Berlin</a>.</p>
<p>Pyexpander has three commands in order to support EPICS macro substitution
which is usually done by the
<a class="reference external" href="http://www.aps.anl.gov/epics/extensions/msi/index.php">msi</a> tool.
These commands may also be useful for other applications.</p>
<p>The idea in msi is to have a template file with macro placeholders in it and
process this file several times with different macro values at each run. In
this mechanism, the filename has only to be mentioned once.</p>
<p>Here is a simple example, test.template has this content:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">record</span><span class="p">(</span><span class="n">calcout</span><span class="p">,</span> <span class="s2">&quot;U3IV:$(name)&quot;</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">field</span><span class="p">(</span><span class="n">CALC</span><span class="p">,</span> <span class="s2">&quot;$(calc)&quot;</span><span class="p">)</span>
  <span class="n">field</span><span class="p">(</span><span class="n">INPA</span><span class="p">,</span> <span class="s2">&quot;U3IV:P4:rip:cvt CPP MS&quot;</span><span class="p">)</span>
  <span class="n">field</span><span class="p">(</span><span class="n">OUT</span><span class="p">,</span>  <span class="s2">&quot;U3IV:P4:rip:calcLRip.A PP MS&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>test.substitution has this content:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$template(&quot;test.template&quot;)\
$subst(
  name=&quot;set&quot;,
  calc=&quot;A+B&quot;,
)\
$subst(
  name=&quot;set2&quot;,
  calc=&quot;C+D&quot;
)\
</pre></div>
</div>
<p>This is the result when test.template is processed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">record</span><span class="p">(</span><span class="n">calcout</span><span class="p">,</span> <span class="s2">&quot;U3IV:set&quot;</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">field</span><span class="p">(</span><span class="n">CALC</span><span class="p">,</span> <span class="s2">&quot;A+B&quot;</span><span class="p">)</span>
  <span class="n">field</span><span class="p">(</span><span class="n">INPA</span><span class="p">,</span> <span class="s2">&quot;U3IV:P4:rip:cvt CPP MS&quot;</span><span class="p">)</span>
  <span class="n">field</span><span class="p">(</span><span class="n">OUT</span><span class="p">,</span>  <span class="s2">&quot;U3IV:P4:rip:calcLRip.A PP MS&quot;</span><span class="p">)</span>
<span class="p">}</span>
<span class="n">record</span><span class="p">(</span><span class="n">calcout</span><span class="p">,</span> <span class="s2">&quot;U3IV:set2&quot;</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">field</span><span class="p">(</span><span class="n">CALC</span><span class="p">,</span> <span class="s2">&quot;C+D&quot;</span><span class="p">)</span>
  <span class="n">field</span><span class="p">(</span><span class="n">INPA</span><span class="p">,</span> <span class="s2">&quot;U3IV:P4:rip:cvt CPP MS&quot;</span><span class="p">)</span>
  <span class="n">field</span><span class="p">(</span><span class="n">OUT</span><span class="p">,</span>  <span class="s2">&quot;U3IV:P4:rip:calcLRip.A PP MS&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As you see, test.template was instantiated twice. In the pyexpander package
there is also a converter program, msi2pyexpander.py, which can be used to convert
substitution files from the EPICS msi format to the pyexpander format.</p>
<p>This is how the three commands work:</p>
<div class="section" id="setting-the-name-of-the-template-file">
<h2>Setting the name of the template file<a class="headerlink" href="#setting-the-name-of-the-template-file" title="Permalink to this headline">¶</a></h2>
<p>The “template” command is used to define the name of an substitution file. It
must be followed by a string expression enclosed in brackets. Note that the
filename is only defined within the current scope (see “variable scopes”).</p>
<p>Here is an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$template(&quot;test.template&quot;)
</pre></div>
</div>
</div>
<div class="section" id="the-subst-command">
<h2>The “subst” command<a class="headerlink" href="#the-subst-command" title="Permalink to this headline">¶</a></h2>
<p>This command is used to substitute macros in the file whose name was defined
with the “template” command before. This command must be followed by an
opening bracket and an arbitrary list of named python parameters. This means
that each parameter definition consists of an unquoted name, an “=” and a
quoted string, several parameter definitions must be separated by commas. The
“subst” command takes these parameters and defines the variables in a new
scope. It then processes the file that was previously set with the “template”
command. Here is an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$subst(
        AMS= &quot;ams_&quot;,
        BASE= &quot;UE112ID7R:&quot;,
        BASE1= &quot;UE112ID7R:&quot;,
        BASE2= &quot;UE112ID7R:S&quot;,
        BaseStatMopVer= &quot;9&quot;,
      )\
</pre></div>
</div>
</div>
<div class="section" id="the-pattern-command">
<h2>The “pattern” command<a class="headerlink" href="#the-pattern-command" title="Permalink to this headline">¶</a></h2>
<p>This command is an alternative way to substitute macros in a file. The pattern command must be followed by an opening round bracket, a list of python tuples and a closing round bracket. Each tuple is a comma separated list of quoted strings enclosed in round brackets. Tuples must be separated by commas. Here is an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$pattern(
          ( &quot;DEVN&quot;, &quot;SIGNAL&quot;),
          ( &quot;PAHRP&quot;, &quot;PwrCavFwd&quot;),
          ( &quot;PAHRP&quot;, &quot;PwrCavRet&quot;),
          ( &quot;PAHRP&quot;, &quot;PwrCircOut&quot;),
        )\
</pre></div>
</div>
<p>The first tuple defines the names of the variables, all following tuples define
values these variables get. For each following tuple the file defined by
“template” is included once. In the example above, the variable “DEVN” has
always the value “PAHRP”, the variable “SIGNAL” has the values “PwrCavFwd”,
“PwrCavRet” and “PwrCircOut”. The file defined by the previous “template”
command is instantiated 3 times.</p>
</div>
<div class="section" id="differences-to-the-epics-msi-tool">
<h2>Differences to the EPICS msi tool<a class="headerlink" href="#differences-to-the-epics-msi-tool" title="Permalink to this headline">¶</a></h2>
<p>These are differences to msi:</p>
<ul class="simple">
<li><p>The file format of substitution files is different, but you can use
msi2pyexpander.py to convert them.</p></li>
<li><p>Macros must always be defined. If a macro should be expanded and it is not
defined at the time, the program stops with an exception. If you want the
program to continue in this case, use the “default” command to provide
default values for the macros that are sometimes not defined.</p></li>
<li><p>Variables defined in a “subst” command are scoped, they are only defined for
that single instantiation of the template file.</p></li>
<li><p>The template file commands “include” and “substitute” as they are known from
msi are not implemented in this form. However, “include” in pyexpander
has the same functionality as “include” in msi and “py” in pyexpander can be
used to do the same as “substitute” in msi.</p></li>
</ul>
<p>Here is an example how to convert a template file from msi to pyexpander. Note
that in pyexpander there is no principal difference between a template and a
substitution file, both have the same syntax. The msi template file is this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>A variable with a default $(var=default value)
Here we include a file:
include &quot;filename&quot;
Here we define a substitution:
substitute &quot;first=Joe,family=Smith&quot;
</pre></div>
</div>
<p>Here is the same formulated for pyexpander:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>A variable with a default $default(var=&quot;default value&quot;)$(var)
Here we include a file:
$include(&quot;filename&quot;)
Here we define a substitution:
$py(first=&quot;Joe&quot;;family=&quot;Smith&quot;)
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction to pyexpander</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference-expander.html">pyexpander reference</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">EPICS support in pyexpander</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#setting-the-name-of-the-template-file">Setting the name of the template file</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-subst-command">The “subst” command</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-pattern-command">The “pattern” command</a></li>
<li class="toctree-l2"><a class="reference internal" href="#differences-to-the-epics-msi-tool">Differences to the EPICS msi tool</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="python3.html">pyexpander for users not familiar with python version 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="expander-options.html">expander.py and expander2.py command line options</a></li>
<li class="toctree-l1"><a class="reference internal" href="msi2pyexpander-options.html">msi2pyexpander.py and msi2pyexpander2.py command line options</a></li>
<li class="toctree-l1"><a class="reference internal" href="pyexpander-install.html">Installing pyexpander</a></li>
<li class="toctree-l1"><a class="reference internal" href="pyexpander-install-by-setup.html">Installing pyexpander by running setup.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">python2</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">pyexpander license</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="reference-expander.html"
                        title="previous chapter">pyexpander reference</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="python3.html"
                        title="next chapter">pyexpander for users not familiar with python version 3</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/epics-support.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="python3.html" title="pyexpander for users not familiar with python version 3"
             >next</a> |</li>
        <li class="right" >
          <a href="reference-expander.html" title="pyexpander reference"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">pyexpander 1.9.2 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Helmholtz-Zentrum Berlin GmbH.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.1.2.
    </div>
  </body>
</html>
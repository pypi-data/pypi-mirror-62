<?xml version="1.0"?>
<module:module xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="XMLModule ../xsd/module_xml.xsd"
    xmlns:module="XMLModule">
<module:coupling>

    <module:general_coupling id="magnetic-heat" name="Joule losses">
        <module:description>Heat generated by Joule losses in magnetic field</module:description>
        <module:modules>
            <module:source id="magnetic" />
            <module:target id="heat" />
        </module:modules>
    </module:general_coupling>

    <module:constants>
        <module:constant id="MU0" value="1.2566371e-06" />
    </module:constants>

<!-- todo: nemely by se pri vypoctu ztrat ve sdruzeni uvazovat i ostatni slozky proudove hustoty?
           tedy tak jak je to zkopirovano pro vyraz pro w_j z magnetickeho modulu?
    <module:expression analysistype="harmonic" axi="(ma_gamma > 0.0) ? 0.5 * (((ma_JVariable*ma_Jer + (1-ma_JVariable)*ma_Jer_compl) - ma_gamma * (ma_vy * dz1) + 2 * PI * f * ma_gamma * (value2+value4/(2*PI*(r+1e-12))))^2 + (ma_Jei - ma_gamma * (ma_vy * dz2) - 2 * PI * f * ma_gamma * (value1+value3/(2*PI*(r+1e-12))))^2) / ma_gamma : 0.0"
        planar="(ma_gamma > 0.0) ? 0.5 * (((ma_JVariable*ma_Jer + (1-ma_JVariable)*ma_Jer_compl) - ma_gamma * ((ma_vx - ma_va * y) * dx1 + (ma_vy + ma_va * x) * dy1) + 2 * PI * f * ma_gamma * (value2+value4))^2 + (ma_Jei - ma_gamma * ((ma_vx - ma_va * y) * dx2 + (ma_vy + ma_va * x) * dy2) - 2 * PI * f * ma_gamma * (value1+value3))^2) / ma_gamma : 0.0"/>-->

    <module:volume>
<!--    todo: slozka pro celkovy proud!!!-->

<!--        puvodni... proc je  value3 a 4 vydeleno?
            <module:vector_form id="harmonic_weak" i="1" j="1" planar="0.5 * ma_gamma * (2 * PI * f)^2 * ((source1 + source3)^2 + (source2 + source4)^2) * vval" axi="0.5 * ma_gamma * (2 * PI * f)^2 * ((source1 + source3/(2*PI*(r+1e-12)))^2 + (source2 + source4/(2*PI*(r+1e-12)))^2) * r * vval" />-->
            <module:vector_form id="harmonic_weak" i="1" j="1" planar="0.5 * ma_gamma * (2 * PI * f)^2 * ((magnetic1)^2 + (magnetic2)^2) * vval" axi="0.5 * ma_gamma * (2 * PI * f)^2 * ((magnetic1)^2 + (magnetic2)^2) * r * vval" />

        <!-- TODO: has to be altered to new harmonic module with 4 fields. i: 3->5 and there will be probably two forms instead of one (i=5, j=1) AND (i=5, j=3)-->
        <module:matrix_form id="harmonic_hard_matrix_newton_3_1" i="5" j="1" planar="- 0.5 * ma_gamma * (2 * PI * f) * (2 * PI * f) * 2 * upval * uval * vval" axi="- 0.5 * ma_gamma * (2 * PI * f) * (2 * PI * f) * 2 * upval * uval * r * vval" />
        <module:matrix_form id="harmonic_hard_matrix_newton_3_2" i="5" j="2" planar="- 0.5 * ma_gamma * (2 * PI * f) * (2 * PI * f) * 2 * upval * uval * vval" axi="- 0.5 * ma_gamma * (2 * PI * f) * (2 * PI * f) * 2 * upval * uval * r * vval" />
        <module:vector_form id="harmonic_hard_vector_newton_3_1" i="5" j="1" planar="- 0.5 * ma_gamma * (2 * PI * f) * (2 * PI * f) * (upval * upval) * vval" axi="- 0.5 * ma_gamma * (2 * PI * f) * (2 * PI * f) * (upval * upval) * r * vval" />
        <module:vector_form id="harmonic_hard_vector_newton_3_2" i="5" j="2" planar="- 0.5 * ma_gamma * (2 * PI * f) * (2 * PI * f) * (upval * upval) * vval" axi="- 0.5 * ma_gamma * (2 * PI * f) * (2 * PI * f) * (upval * upval) * r * vval" />

       <!-- magnetic steady state-->
       <module:vector_form id="steady_weak" i="1" j="1" planar="ma_gamma * (((ma_vx - y * ma_va) * magnetic1dx + (ma_vy + x * ma_va) * magnetic1dy)^2) * vval" axi="0" />

        <module:weakforms_volume>
            <module:weakform_volume couplingtype="weak" sourceanalysis="harmonic" analysistype="steadystate" equation="">
                <module:linearity_option type="linear">
                    <module:vector_form id="harmonic_weak" />
                </module:linearity_option>

                <module:linearity_option type="newton">
                    <module:vector_form id="harmonic_weak" coefficient="-1"/>
                </module:linearity_option>

            </module:weakform_volume>

            <module:weakform_volume couplingtype="hard" sourceanalysis="harmonic" analysistype="steadystate" equation="">
                <module:linearity_option type="newton">
                    <module:matrix_form id="harmonic_hard_matrix_newton_3_1"/>
                    <module:matrix_form id="harmonic_hard_matrix_newton_3_2"/>
                    <module:vector_form id="harmonic_hard_vector_newton_3_1"/>
                    <module:vector_form id="harmonic_hard_vector_newton_3_2"/>
                </module:linearity_option>

            </module:weakform_volume>

            <module:weakform_volume couplingtype="weak" sourceanalysis="harmonic" analysistype="transient" equation="">
                <module:linearity_option type="linear">
                    <module:vector_form id="harmonic_weak" />
                </module:linearity_option>

                <module:linearity_option type="newton">
                    <module:vector_form id="harmonic_weak" coefficient="-1"/>
                </module:linearity_option>

            </module:weakform_volume>

            <module:weakform_volume couplingtype="hard" sourceanalysis="harmonic" analysistype="transient" equation="">
                <module:linearity_option type="newton">
                    <module:matrix_form id="harmonic_hard_matrix_newton_3_1"/>
                    <module:matrix_form id="harmonic_hard_matrix_newton_3_2"/>
                    <module:vector_form id="harmonic_hard_vector_newton_3_1"/>
                    <module:vector_form id="harmonic_hard_vector_newton_3_2"/>
                </module:linearity_option>

            </module:weakform_volume>

            <module:weakform_volume couplingtype="weak" sourceanalysis="steadystate" analysistype="steadystate" equation="">
                <module:linearity_option type="linear">
                    <module:vector_form id="steady_weak" />
                </module:linearity_option>

                <module:linearity_option type="newton">
                    <module:vector_form id="steady_weak" coefficient="-1"/>
                </module:linearity_option>

            </module:weakform_volume>

            <module:weakform_volume couplingtype="weak" sourceanalysis="steadystate" analysistype="transient" equation="">
                <module:linearity_option type="linear">
                    <module:vector_form id="steady_weak" />
                </module:linearity_option>

                <module:linearity_option type="newton">
                    <module:vector_form id="steady_weak" coefficient="-1"/>
                </module:linearity_option>

            </module:weakform_volume>

        </module:weakforms_volume>
    </module:volume>
</module:coupling>
</module:module>
